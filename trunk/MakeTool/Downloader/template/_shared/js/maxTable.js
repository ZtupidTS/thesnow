var maxTable={};maxTable.create=function(A){return{objID:A,id:A,wrapperID:A+"_wrapper",tableTag:' width="96%" cellpadding="0" cellspacing="0" border="0"',style:{table:"maxTable",control:"maxTable-control","edit-control":"maxTable-edit-control","edit-note":"maxTable-edit-note",row:"maxTable-row",hover:"maxTable-hover",edit:"maxTable-edit",separator:"maxTable-separator","separator-hover":"maxTable-separator-hover","separator-edit":"maxTable-separator-edit"},dataType:"array",columns:[],data:[],defaultRowData:[],separatorType:"none",defaultSeparatorText:"---",lang:{delete_confirm:"Are you sure to delete this item?",required:'"%s" can not be blank.'},allowInsert:true,allowEdit:true,allowEditSeparator:true,showEditControl:true,confirmDelete:true,showHeader:true,editControl:[{type:"move_up"},{type:"html",value:" "},{type:"move_down"},{type:"html",value:" | "},{type:"delete",hideOnNew:true},{type:"html",value:" | ",hideOnNew:true},{type:"save"},{type:"html",value:" | "},{type:"cancel"}],controlUI:{add:"Add Item",add_sep:"Add Separator",separator:"&nbsp;",move_up:'<img src="images/btn_up.png" />',move_down:'<img src="images/btn_down.png" />',"delete":"Delete",save:"Save",cancel:"Cancel",radio:'<img src="images/btn_radio.png" />',radio_checked:'<img src="images/btn_radio_checked.png" />',checkbox:'<img src="images/btn_check.png" />',checkbox_checked:'<img src="images/btn_check_checked.png" />'},content:{buildTableControls:null,buildEditControls:null},event:{beforeInit:function(){return true},afterInit:function(){},beforeDestroy:function(){return true},afterDestroy:function(){},beforeEdit:function(){return true},afterEdit:function(){},beforeCancel:function(){return true},afterCancel:function(){},beforeAdd:function(){return true},afterAdd:function(){},beforeUpdate:function(){return true},afterUpdate:function(){},beforeDelete:function(B){return true},afterDelete:function(B){},beforeRadioClick:function(C,B){return true},afterRadioClick:function(D,B,C){},beforeCheckboxClick:function(C,B){return true},afterCheckboxClick:function(C,B){}},inAction:"",inEditRow:null,inEditDataIndex:-1,inEditBackupData:null,inEditResultData:null,moveOffset:0}};maxTable.init=function(A){A.inAction="init";if(!A.event.beforeInit()){return false}maxTable.ui.attachTable(A);A.event.afterInit();A.inAction=""};maxTable.destroy=function(A){A.inAction="destroy";if(!A.event.beforeDestroy()){return false}maxTable.ui.detachTable(A);A.event.afterDestroy();delete A};maxTable.ui={};maxTable.ui.attachTable=function(A){if(!(A.data instanceof Array)){alert("maxTable.ui.attachTable : "+A.id+".data is not an Array\n"+$toJSON(A.data));return}var B=$id(A.wrapperID);if(B){B.innerHTML=maxTable.ui.buildTable(A)}else{alert("maxTable.ui.attachTable : "+A.wrapperID+" not Found")}};maxTable.ui.detachTable=function(A){var B=$id(A.wrapperID);if(B){B.innerHTML=""}};maxTable.ui.buildTable=function(A){var C='<table id="'+A.id+'" '+A.tableTag+' class="'+A.style.table+'">\n';C+=maxTable.ui.buildHeader(A);for(var B=0;B<A.data.length;B++){C+=maxTable.ui.buildRow(A,B)}C+=maxTable.ui.buildFooter(A);C+="</table>\n";return C};maxTable.ui.buildHeader=function(B){var D="<tr"+(B.showHeader?"":' style="display:none"')+">\n";for(var C=0;C<B.columns.length;C++){var A="";if(B.columns[C].width){A+=' width="'+B.columns[C].width+'"'}if(B.columns[C].tagx){A+=B.columns[C].tagx}D+="<th"+A+">"+B.columns[C].title+"</th>"}D+="</tr>\n";return D};maxTable.ui.buildFooter=function(A){var B="";if(A.allowInsert){B+='<tr class="'+A.style.control+'"><td colspan="'+A.columns.length+'">';if(A.content.buildTableControls){B+=A.content.buildTableControls()}else{B+='<a href="javascript:;" onclick="maxTable.action.addRow('+A.objID+')">'+A.controlUI.add+"</a>";if(A.separatorType!="none"&&A.allowEditSeparator){B+='&nbsp;&nbsp;|&nbsp;&nbsp;<a href="javascript:;" onclick="maxTable.action.addRow('+A.objID+', true)">'+A.controlUI.add_sep+"</a>"}}B+="</td></tr>\n"}return B};maxTable.ui.buildRow=function(A,E){var C="";var D=maxTable.ui.buildCellHTML(A,E);if(D.type=="array"){C+='<tr onclick="maxTable.action.editRow('+A.objID+', this)" onmouseover="this.className=\''+A.style.hover+"'\" onmouseout=\"this.className='"+A.style.row+'\'" class="'+A.style.row+'">\n';for(var B=0;B<D.data.length;B++){C+="<td"+(A.columns[B].width?' width="'+A.columns[B].width+'"':"")+(A.columns[B].tagx?A.columns[B].tagx:"")+(D.data[B].onclick?' onclick="'+D.data[B].onclick+'"':"")+">"+D.data[B].html+"</td>\n"}C+="</tr>\n"}else{C+="<tr"+(A.allowEditSeparator?' onclick="maxTable.action.editRow('+A.objID+', this)" onmouseover="this.className=\''+A.style["separator-hover"]+"'\" onmouseout=\"this.className='"+A.style.separator+"'\"":"")+' class="'+A.style.separator+'">\n<td colspan="'+A.columns.length+'">'+D.data+"</td></tr>\n"}return C};maxTable.ui.addRow=function(B,A,G){var F=$id(B.id);var D=F.rows.length-(B.allowInsert?1:0);var C=F.insertRow(D);var H;if(B.separatorType!="none"&&A){H=C.insertCell();H.colSpan=B.columns.length;if(G){B.data.push(G)}else{B.data.push(B.defaultSeparatorText)}}else{for(var E=0;E<B.columns.length;E++){H=C.insertCell();maxTable.action.addRowEventHelper(B,H,E)}if(G){B.data.push(G)}else{B.data.push($clone(B.defaultRowData))}}maxTable.ui.updateRow(B,B.data.length-1);return B.data.length-1};maxTable.ui.deleteRow=function(A,D){var C=$id(A.id);if(A.showEditControl&&A.inEditDataIndex==D&&A.inAction=="edit"){C.deleteRow(D+2);A.inAction="";A.inEditRow=null;A.inEditDataIndex=-1}C.deleteRow(D+1);var B=A.data.splice(D,1)[0];return B};maxTable.ui.editRow=function(A,D){if(A.inAction=="pre_add"){A.inAction="add"}else{A.inAction="edit"}A.inEditRow=$id(A.id).rows(D+1);A.inEditDataIndex=D;A.moveOffset=0;A.inEditBackupData=$clone(A.data[A.inEditDataIndex]);maxTable.ui.updateRow(A,A.inEditDataIndex);if(A.showEditControl){var B=$id(A.id).insertRow(A.inEditRow.rowIndex+1);B.className=A.style["edit-control"];var C=B.insertCell();C.colSpan=A.columns.length;C.innerHTML=maxTable.ui.buildEditControls(A)}C=null;B=null};maxTable.ui.cancelEditRow=function(A){if(A.showEditControl){$id(A.id).deleteRow(A.inEditRow.rowIndex+1)}if(A.moveOffset!=0){var B=$id(A.id);B.moveRow(A.inEditRow.rowIndex,A.inEditRow.rowIndex-A.moveOffset)}if(A.inAction=="add"){A.data.splice(A.inEditRow.rowIndex-1,1);A.inEditRow.removeNode(true)}else{A.inAction="";maxTable.ui.updateRow(A,A.inEditDataIndex)}A.inAction="";A.inEditRow=null;A.inEditDataIndex=-1};maxTable.ui.doCheckbox=function(A,F,E,D){var C=E;if(A.columns[E].name){C=A.columns[E].name}if(D!=undefined){A.data[F][C]=D}else{var B=A.data[F][C];if(B){A.data[F][C]=false}else{A.data[F][C]=true}}maxTable.ui.updateRow(A,F)};maxTable.ui.updateRow=function(C,G){var F=false;var A=1;if(C.inAction=="edit"||C.inAction=="add"){F=true;if(C.inEditDataIndex!=G){F=false}if(C.showEditControl&&C.inEditDataIndex<G){A=2}}var B=$id(C.id).rows(G+A);if(!B){return}var E=maxTable.ui.buildCellHTML(C,G);if(!E){return}if(E.type=="array"){if(F){B.onclick=null;B.onmouseover=null;B.onmouseout=null;B.className=C.style.edit}else{B.onclick=function(){return maxTable.action.editRow(C,this)};B.onmouseover=function(){this.className=C.style.hover};B.onmouseout=function(){this.className=C.style.row};B.className=C.style.row}for(var D=0;D<E.data.length;D++){if(!E.data[D].noUpdate){B.cells[D].innerHTML=E.data[D].html}}}else{B.cells[0].colSpan=C.columns.length;B.cells[0].innerHTML=E.data;if(F){B.onclick=null;B.onmouseover=null;B.onmouseout=null;B.className=C.style["separator-edit"]}else{B.onclick=function(){return maxTable.action.editRow(C,this)};B.onmouseover=function(){this.className=C.style["separator-hover"]};B.onmouseout=function(){this.className=C.style.separator};B.className=C.style.separator}}};maxTable.ui.buildCellHTML=function(H,I){var B=H.data[I];if(!B){return null}if(maxTable.data.isSeparator(H,I)){var F="";if(H.separatorType=="text"){if(H.inAction=="edit"||H.inAction=="add"){F='<input id="'+H.id+'_edit_0" value="'+B.$encodeHTML()+'" type="text" class="text" />'}else{F=B.$encodeHTML()}}else{F=H.controlUI.separator}return{type:"separator",data:F}}else{var A=[];for(var E=0;E<H.columns.length;E++){var G=E;if(H.dataType=="object"){G=H.columns[E].name;A[E]={}}else{A[E]=[]}switch(H.columns[E].type){case"radio":if(H.columns[E].customUI){A[E]["html"]=(B[G]==true?H.columns[E].customUI.checked:H.columns[E].customUI.unchecked)}else{A[E]["html"]=(B[G]==true?H.controlUI.radio_checked:H.controlUI.radio)}if(!H.columns[E].readOnly){if(H.inAction=="init"){A[E]["onclick"]="maxTable.action.radioClick("+H.objID+", this, "+E+")"}}break;case"checkbox":if(H.columns[E].customUI){A[E]["html"]=(B[G]==true?H.columns[E].customUI.checked:H.columns[E].customUI.unchecked)}else{A[E]["html"]=(B[G]==true?H.controlUI.checkbox_checked:H.controlUI.checkbox)}if(!H.columns[E].readOnly){if(H.inAction=="init"){A[E]["onclick"]="maxTable.action.checkBoxClick("+H.objID+", this, "+E+")"}}break;case"select":if(!H.columns[E].readOnly&&(H.inAction=="edit"||H.inAction=="add")){A[E]["html"]='<select id="'+H.id+"_edit_"+G+'">';for(var C=0;C<H.columns[E].selectOptions.length;C++){A[E]["html"]+='<option value="'+H.columns[E].selectOptions[C][1]+'"'+(B[G]==H.columns[E].selectOptions[C][1]?' selected="selected"':"")+">"+H.columns[E].selectOptions[C][0]+"</option>"}A[E]["html"]+="</select>"}else{if(B[G]==""){A[E]["html"]="&nbsp;"}else{A[E]["html"]=B[G].$encodeHTML()}}break;case"textarea":if(!H.columns[E].readOnly&&(H.inAction=="edit"||H.inAction=="add")){A[E]["html"]='<textarea id="'+H.id+"_edit_"+G+'"'+(H.columns[E].rows?' rows="'+H.columns[E].rows+'"':"")+">"+B[G].$encodeHTML(true)+"</textarea>"}else{if(B[G]==""){A[E]["html"]="&nbsp;"}else{A[E]["html"]=B[G].$encodeHTML()}}break;case"html":if(H.inAction=="init"){A[E]["html"]=B[G]}else{A[E]["noUpdate"]=true}break;case"custom":var D=H.columns[E].customBuilder(I,E);if(D==null){A[E]["noUpdate"]=true}else{A[E]["html"]=D}break;default:if(!H.columns[E].readOnly&&(H.inAction=="edit"||H.inAction=="add")){A[E]["html"]='<input id="'+H.id+"_edit_"+G+'" value="'+B[G].$encodeHTML()+'" type="text" class="text" />'}else{if(B[G]==""){A[E]["html"]="&nbsp;"}else{A[E]["html"]=B[G].$encodeHTML()}}}if(H.columns[E].editNote&&(H.inAction=="edit"||H.inAction=="add")){A[E]["html"]+='<div class="'+H.style["edit-note"]+'">'+H.columns[E].editNote+"</div>"}}return{type:"array",data:A}}};maxTable.ui.buildEditControls=function(A){if(A.content.buildEditControls){return A.content.buildEditControls()}var C="";for(var B=0;B<A.editControl.length;B++){if(A.editControl[B].hideOnNew&&A.inAction=="add"){continue}switch(A.editControl[B].type){case"move_up":C+='<a href="javascript:;" onclick="maxTable.action.moveRow('+A.objID+', -1)">'+A.controlUI.move_up+"</a>";break;case"move_down":C+='<a href="javascript:;" onclick="maxTable.action.moveRow('+A.objID+', 1)">'+A.controlUI.move_down+"</a>";break;case"delete":C+='<a href="javascript:;" onclick="maxTable.action.deleteEdit('+A.objID+')">'+A.controlUI["delete"]+"</a>";break;case"save":C+='<a href="javascript:;" onclick="maxTable.action.saveEdit('+A.objID+')">'+A.controlUI.save+"</a>";break;case"cancel":C+='<a href="javascript:;" onclick="maxTable.action.cancelEdit('+A.objID+')">'+A.controlUI.cancel+"</a>";break;case"html":C+=A.editControl[B].value;break}}return C};maxTable.data={};maxTable.data.isSeparator=function(A,B){return(A.separatorType!="none"&&typeof(A.data[B])=="string")};maxTable.data.getEditResult=function(A){var D=$clone(A.data[A.inEditDataIndex]);if(maxTable.data.isSeparator(A,A.inEditDataIndex)){if(A.separatorType=="text"){D=$id(A.id+"_edit_0").value;if(D.replace(" ","")==""){alert(A.lang.sep_require);return null}}else{D="---"}}else{for(var B=0;B<A.columns.length;B++){if(!A.columns[B].readOnly){var C=B;if(A.dataType=="object"){C=A.columns[B].name}if(A.columns[B].type=="text"||A.columns[B].type=="textarea"){D[C]=$id(A.id+"_edit_"+C).value}if(A.columns[B].type=="select"){var E=$id(A.id+"_edit_"+C);D[C]=E.options[E.selectedIndex].value}if(A.columns[B].required&&D[C].$trim()==""){alert(A.lang.require.replace("%s",A.columns[B].title));return null}}}}return D};maxTable.data.applyRowDataMove=function(A){var B=A.data[A.inEditDataIndex];var C=A.data[A.inEditDataIndex+A.moveOffset];if(A.moveOffset<0){A.data.splice(A.inEditDataIndex,1);A.data.splice(A.inEditDataIndex+A.moveOffset,1,B,C)}else{A.data.splice(A.inEditDataIndex+A.moveOffset,1,C,B);A.data.splice(A.inEditDataIndex,1)}A.inEditDataIndex+=A.moveOffset;A.moveOffset=0};maxTable.action={};maxTable.action.addRow=function(B,A){if(B.inAction=="edit"||B.inAction=="add"){if(maxTable.action.saveEdit(B)){maxTable.action.addRow(B,A)}return}if(B.inAction!=""){return}B.inAction="pre_add";var C=maxTable.ui.addRow(B,A);maxTable.action.editRow(B,C)};maxTable.action.addRowEventHelper=function(A,C,B){if(A.columns[B].type=="radio"){C.onclick=function(){return maxTable.action.radioClick(A,C,B)}}if(A.columns[B].type=="checkbox"){C.onclick=function(){return maxTable.action.checkBoxClick(A,C,B)}}};maxTable.action.editRow=function(A,B){if(!A.allowEdit){return}if(typeof(B)=="number"){B=$id(A.id).rows(B+1)}if(A.inEditRow==B){return}if(A.inEditRow!=B&&(A.inAction=="add"||A.inAction=="edit")){if(A.inAction=="add"){maxTable.action.cancelEdit(A);maxTable.action.editRow(A,B)}else{if(maxTable.action.saveEdit(A)){maxTable.action.editRow(A,B)}}return}if(!A.event.beforeEdit(B.rowIndex-1)){A.inEditRow=null;A.inEditDataIndex=-1;return}maxTable.ui.editRow(A,B.rowIndex-1);A.event.afterEdit()};maxTable.action.moveRow=function(B,D){var C=$id(B.id);var A=B.inEditRow.rowIndex;if(D==-1){if(A==1&&D==-1){return}C.moveRow(A,A-1);if(B.showEditControl){C.moveRow(A+1,A)}}else{if(A==(C.rows.length-(B.showEditControl?3:2))&&D==1){return}if(B.showEditControl){C.moveRow(A+1,A+2)}C.moveRow(A,A+1)}B.moveOffset+=D};maxTable.action.saveEdit=function(B){if(B.inAction!="add"&&B.inAction!="edit"){return false}B.inEditResultData=maxTable.data.getEditResult(B);if(!B.inEditResultData){return false}var A;if(B.inAction=="add"){A=B.event.beforeAdd()}else{A=B.event.beforeUpdate()}if(A==false){return false}if(B.moveOffset!=0){maxTable.data.applyRowDataMove(B)}if(A==true){B.data[B.inEditDataIndex]=$clone(B.inEditResultData)}if(B.inAction=="add"){B.event.afterAdd()}else{B.event.afterUpdate()}B.inEditResultData=null;B.inAction="save";maxTable.action.cancelEdit(B);return true};maxTable.action.deleteEdit=function(A){if(A.inAction!="edit"){return}if(!A.event.beforeDelete(A.data[A.inEditDataIndex])){return}if(A.confirmDelete&&!confirm(A.lang.delete_confirm)){return}var B=maxTable.ui.deleteRow(A,A.inEditDataIndex);A.event.afterDelete(B);A.inAction="";A.inEditRow=null;A.inEditDataIndex=-1};maxTable.action.cancelEdit=function(A){if(A.inAction==""){return}if(!A.event.beforeCancel()){return}maxTable.ui.cancelEditRow(A);A.event.afterCancel()};maxTable.action.radioClick=function(A,C,F){if(A.inAction!=""){maxTable.action.saveEdit(A)}A.inAction="radioclick";while(C.tagName!="TR"){C=C.parentNode}var G=C.rowIndex-1;if(!A.event.beforeRadioClick(G,F)){return}var E=-1;var B=F;if(A.dataType=="object"){B=A.columns[F].name}for(var D=0;D<A.data.length;D++){if(typeof(A.data[D])=="object"){if(A.data[D][B]==true){A.data[D][B]=false;E=D}}}A.data[G][B]=true;maxTable.ui.updateRow(A,E);maxTable.ui.updateRow(A,G);A.event.afterRadioClick(E,G,F);if(window.event){window.event.cancelBubble=true}A.inAction=""};maxTable.action.checkBoxClick=function(A,B,C){if(A.inAction!=""){maxTable.action.saveEdit(A)}A.inAction="checkclick";if(window.event){window.event.cancelBubble=true}while(B.tagName!="TR"){B=B.parentNode}var D=B.rowIndex-1;if(!A.event.beforeCheckboxClick(D,C)){return}maxTable.ui.doCheckbox(A,D,C);A.event.afterCheckboxClick(D,C);A.inAction=""};