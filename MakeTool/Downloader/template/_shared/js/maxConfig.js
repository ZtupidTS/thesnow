var maxConfig={};maxConfig.defaultFile="$main";maxConfig.files={};maxConfig.silentChange=false;maxConfig.setActiveFile=function(C,A){if(!C){C=maxConfig.defaultFile}if(A==undefined){A=false}if(!maxConfig.files[C]){maxConfig.files[C]={api:null,modified:false,saveOnChange:A};try{maxConfig.files[C].api=external.max_getObject("","INIManager")}catch(B){alert("maxConfig :: INIT OBJECT FAILED");return}maxConfig.files[C].api.fileName=C;if(!maxConfig.files[C].api.load()){alert("maxConfig :: LOAD FILE FAILED - "+C);return}}maxConfig.activeFile=maxConfig.files[C]};maxConfig.load=function(){maxConfig.activeFile.api.load();maxConfig.activeFile.modified=false};maxConfig.save=function(){maxConfig.activeFile.api.save();maxConfig.activeFile.modified=false};maxConfig.ui={};maxConfig.ui.buildItems=function(B){var A="";for(var C=0;C<B.length;C++){var E=B[C];var D="";if(!E.type){alert("maxConfig.ui.buildItems :: missing item type\n"+$toJSON(E));continue}if((E.id&&!E.key)||(!E.id&&E.key)){alert('maxConfig.ui.buildItems :: missing item id/key for "'+E.id+'"');continue}switch(E.type){case"header":D="<h5>"+E.html+"</h5>\n";E.noWrapper=true;break;case"html":D=E.html;E.noWrapper=true;break;case"text":D=E.text.$encodeHTML();break;case"hr":D="<hr />\n";E.noWrapper=true;break;case"checkbox":D=maxConfig.ui.checkbox.build(E);break;case"textbox":D=maxConfig.ui.textbox.build(E);break;case"textarea":D=maxConfig.ui.textbox.buildArea(E);break;case"color":D=maxConfig.ui.color.build(E);break;case"key":D=maxConfig.ui.key.build(E);break;case"radio":D=maxConfig.ui.radio.build(E);break;case"folder":D=maxConfig.ui.folder.build(E);break;default:alert("maxConfig.ui.buildPage :: unknown type of item\n"+$toJSON(E))}if(E.noWrapper){A+=D}else{if(E.type=="text"){A+="<p>"+D+"</p>"}else{A+='<div class="'+(E.disabled?"item-disabled":"item")+'" id="item_'+E.id+'">'+D+"</div>"}}}return A};maxConfig.ui.disableItem=function(C){var B=$id(C);if(B){B.disabled=true}var D=$name(C);if(D){for(var A=0;A<D.length;A++){D[A].disabled=true}}var B=$id("item_"+C);if(!B){return}B.className="item-disabled"};maxConfig.ui.enableItem=function(C){var B=$id(C);if(B){B.disabled=false}var D=$name(C);if(D){for(var A=0;A<D.length;A++){D[A].disabled=false}}var B=$id("item_"+C);if(!B){return}B.className="item"};maxConfig.ui.getItemValue=function(A){if(A.html==undefined){A.html=$lang(A.id)}if(A.pre==undefined){A.pre=""}if(A.suf==undefined){A.suf=""}if(A.onAfterClick==undefined){A.onAfterClick=""}var B=maxConfig.ini.getValue(A.section,A.key);if(B==null){if(A.defaultValue){return A.defaultValue}else{return""}}else{return B}};maxConfig.ui.checkbox={};maxConfig.ui.checkbox.build=function(B){var A="";if(maxConfig.ui.getItemValue(B)=="1"){A+=' checked="checked"'}if(B.disabled){A+=' disabled="disabled"'}A+=" onclick=\"maxConfig.ui.checkbox.set('"+B.id+"', '"+B.key+"', '"+B.section+"', '"+B.file+"');"+B.onAfterClick+'"';A='<input type="checkbox" id="'+B.id+'"'+A+' /><label for="'+B.id+'"> '+B.html+"</label>";A=B.pre+A+B.suf;return A};maxConfig.ui.checkbox.set=function(B,C,E,A){var D=$id(B);if(D){if(D.checked){maxConfig.ini.setValue(E,C,"1")}else{maxConfig.ini.setValue(E,C,"0")}}else{alert("maxConfig.ui.checkbox.set :: invalid id "+B)}};maxConfig.ui.textbox={};maxConfig.ui.textbox.build=function(B,C){var A="";A+=' value="'+maxConfig.ui.getItemValue(B).$encodeHTML()+'"';if(B.disabled){A+=' disabled="disabled"'}A+=" onchange=\"maxConfig.ui.textbox.set('"+B.id+"', '"+B.key+"', '"+B.section+"', '"+B.file+"');\"";if(B.tagx){A+=" "+B.tagx}A=' <input type="text" class="text" id="'+B.id+'"'+A+" /> ";A=B.pre+A+B.suf;return A};maxConfig.ui.textbox.buildArea=function(B){var A="";var C=maxConfig.ui.getItemValue(B).$encodeHTML(true);if(B.disabled){A+=' disabled="disabled"'}A+=" onchange=\"maxConfig.ui.textbox.set('"+B.id+"', '"+B.key+"', '"+B.section+"', '"+B.file+"');\"";if(B.tagx){A+=" "+B.tagx}A=' <textarea id="'+B.id+'"'+A+">"+C+"</textarea>";A=B.pre+A+B.suf;return A};maxConfig.ui.textbox.set=function(B,C,E,A){var D=$id(B);if(D){maxConfig.ini.setValue(E,C,D.value)}else{alert("maxConfig.ui.textbox.set :: invalid id "+B)}};maxConfig.ui.color={};maxConfig.ui.color.build=function(B){var C=maxConfig.ui.getItemValue(B);var D=maxConfig.ui.color.calculateInvertColor(C);var A="";A+=' <span id="'+B.id+'" class="color-spot" style="color: '+D+";background: "+C.$encodeHTML()+';" onclick="this.blur();maxConfig.ui.color.set(\''+B.id+"', '"+B.key+"', '"+B.section+"', '"+B.file+"');"+B.onAfterClick+'">'+C.$encodeHTML()+"</span> ";A=B.pre+A+B.suf;return A};maxConfig.ui.color.set=function(C,E,H,B){var G=$id(C);if(!G){return}var A=G.innerHTML;var F=external.max_getObj("","utilities");var D=F.getColor(A);if(D!=undefined){maxConfig.ini.setValue(H,E,D);maxConfig.ui.color.updateUI(C,D)}};maxConfig.ui.color.calculateInvertColor=function(C){var F=C.replace(/[^0-9a-f]/ig,"");if(F.length!=6){return"#FFFFFF"}var B="";for(var E=0;E<3;E++){var A=F.substr(E*2,2);var D=parseInt(A,16);D=255-D;A=D.toString(16);if(A.length!=2){A="0"+A}B+=A.toUpperCase()}return B};maxConfig.ui.color.updateUI=function(B,A){var C=$id(B);if(C){C.style.color=maxConfig.ui.color.calculateInvertColor(A);C.style.background=A;C.innerHTML=A.$encodeHTML()}};maxConfig.ui.radio={};maxConfig.ui.radio.build=function(E){var D=maxConfig.ui.getItemValue(E);if(E.inline){E.inlineSpacer=E.inlineSpacer?E.inlineSpacer:" &nbsp; "}var B="";if(!E.noHeader){B+="<h5>"+E.html+"</h5>\n"}for(var C=0;C<E.choices.length;C++){var A=E.choices[C];B+=(E.inline?'<span class="radio-item-inline'+(A.disabled?" radio-item-disabled":"")+'">':'<div class="radio-item'+(A.disabled?" radio-item-disabled":"")+'">')+(A.pre?A.pre:"")+'<input type="radio" name="'+E.id+'" id="'+E.id+"_"+C+'" value="'+A.value+'" onclick="maxConfig.ui.radio.set(\''+E.id+"', '"+E.key+"', '"+E.section+"', '"+E.file+"');"+E.onAfterClick+'" '+((D==A.value)?'checked="checked"':"")+" "+(E.disabled||A.disabled?'disabled="disabled"':"")+'/><label for="'+E.id+"_"+C+'"> '+A.html+"</label>"+(A.suf?A.suf:"")+(E.inline?"</span>"+E.inlineSpacer:"</div>")}B=E.pre+B+E.suf;return B};maxConfig.ui.radio.set=function(G,C,E,A){var F=$name(G);if(F){var D=F[0].value;for(var B=0;B<F.length;B++){if(F[B].checked){D=F[B].value;break}}maxConfig.ini.setValue(E,C,D)}else{alert("maxConfig.ui.radio.set :: invalid id "+G)}};maxConfig.ui.key={};maxConfig.ui.key.build=function(C){var B=maxConfig.ui.key.parseData(maxConfig.ui.getItemValue(C));var A="";A+=' <span id="'+C.id+'" class="label-item">'+B[1].$encodeHTML()+"</span> ";A+=' &nbsp; <a href="javascript:;" onclick="this.blur();maxConfig.ui.key.set(\''+C.id+"', '"+C.key+"', '"+C.section+"', '"+C.file+"');"+C.onAfterClick+'">'+$lang("set_key")+"</a> ";A=C.pre+A+C.suf;return A};maxConfig.ui.key.set=function(C,D,E,A){var B=external.max_invoke("GetHotKey");if(B!=-1){maxConfig.ini.setValue(E,D,B);maxConfig.ui.key.updateUI(C,B)}};maxConfig.ui.key.parseData=function(B){if(B==undefined){B=""}var A=B.split("$:$");if(A.length==2){if(A[1]!=""){return A}}A[0]="csa_0";A[1]="none";return A};maxConfig.ui.key.updateUI=function(B,A){var E=$id(B);if(E){var C=maxConfig.ui.key.parseData(A);if(C[1]=="none"){try{C[1]=$lang("none")}catch(D){}}E.innerHTML=C[1].$encodeHTML()}else{alert("maxConfig.ui.key.updateUI :: invalid id "+B)}};maxConfig.ui.folder={};maxConfig.ui.folder.build=function(C){var B=maxConfig.ui.getItemValue(C);if(B==""){B="..."}B=maxConfig.ui.folder.cutString(B);C.subType=C.subType?C.subType:"folder";var A="";A+='<span id="'+C.id+'" class="label-item">'+B+"</span>";A+=' &nbsp; <a href="javascript:;" onclick="this.blur();maxConfig.ui.folder.set(\''+C.id+"', '"+C.key+"', '"+C.section+"', '"+C.file+"', '"+C.subType+"');"+C.onAfterClick+'">'+$lang("browse")+"</a> ";A=C.pre+A+C.suf;return A};maxConfig.ui.folder.set=function(B,C,E,A,F){var D=(F=="fav")?external.max_invoke("SelFavFolder"):external.max_invoke("SelFolder");if(D!=0){maxConfig.ini.setValue(E,C,D);maxConfig.ui.folder.updateUI(B,D)}};maxConfig.ui.folder.cutString=function(A){if(A.length>50){var C="";var B=A.lastIndexOf("/");if(B>25){C=A.substring(B,A.length)}else{C=A.substring(A.length-25,A.length)}return A.substr(0,25)+"..."+C}return A};maxConfig.ui.folder.updateUI=function(A,B){var C=$id(A);if(C){if(B==""){B=="..."}B=maxConfig.ui.folder.cutString(B);C.innerHTML=B.$encodeHTML()}else{alert("maxConfig.ui.folder.updateUI :: invalid id "+A)}};maxConfig.ini={};maxConfig.ini.encodeChars=function(A,B){if(typeof(A)!="string"){return A}A=A.replace(/\t/g,"\\t");A=A.replace(/\n/g,"\\n");A=A.replace(/\r/g,"\\r");if(B!=undefined){A=A.replace(/\=/g,"&#61;");A=A.replace(/\[/g,"{{")}return A};maxConfig.ini.decodeChars=function(A,B){if(typeof(A)!="string"){return A}A=A.replace(/\\t/g,"\t");A=A.replace(/\\n/g,"\n");A=A.replace(/\\r/g,"\r");if(B!=undefined){A=A.replace(/\&\#61;/g,"=");A=A.replace(/\{\{/g,"[")}return A};maxConfig.ini.getValue=function(C,A){var B=maxConfig.activeFile.api.readValue(C,A,"__na__");if(B=="__na__"){B=null}return B};maxConfig.ini.setValue=function(C,A,B){maxConfig.activeFile.api.writeValue(C,A,B);if(!maxConfig.activeFile.silentChange){maxConfig.activeFile.modified=true}if(maxConfig.activeFile.saveOnChange){maxConfig.save()}};maxConfig.ini.deleteKey=function(B,A){maxConfig.activeFile.api.deleteKey(B,A);if(!maxConfig.activeFile.silentChange){maxConfig.activeFile.modified=true}if(maxConfig.activeFile.saveOnChange){maxConfig.save()}};maxConfig.ini.deleteSection=function(A){maxConfig.activeFile.api.deleteSection(A);if(!maxConfig.activeFile.silentChange){maxConfig.activeFile.modified=true}if(maxConfig.activeFile.saveOnChange){maxConfig.save()}};maxConfig.ini.getArray=function(E,B){if(B==undefined){B=false}var C=[];maxConfig.activeFile.api.readSection(E,C);if(B){C.sort()}var A=[];for(var D=0;D<C.length;D++){if(C[D]!=""){C[D]=C[D].split("$,$");if(B){if(C[D][0].indexOf("_s")>-1){C[D]=C[D][1]}else{C[D].shift()}}A.push(C[D])}}return A};maxConfig.ini.setArray=function(F,G,A){if(A==undefined){A=false}if(A){var B=G.length.toString().length;for(var D=0;D<G.length;D++){var C=D.toString();while(C.length<B){C="0"+C}if(typeof(G[D])=="string"){maxConfig.activeFile.api.writeValue(F,C+"_s",G[D])}else{maxConfig.activeFile.api.writeValue(F,C,G[D].join("$,$"))}}}else{for(var D=0;D<G.length;D++){var E=$clone(G[D]);var C=E.shift();maxConfig.activeFile.api.writeValue(F,C,E.join("$,$"))}}if(!maxConfig.activeFile.silentChange){maxConfig.activeFile.modified=true}if(maxConfig.activeFile.saveOnChange){maxConfig.save()}};maxConfig.res={};maxConfig.res.filterPath=external.max_invoke("getPath","filter");maxConfig.res.load=function(E){var H=external.max_getResList(E);if(H==""){return[]}var B=H.split("$|$");for(var D=0;D<B.length;D++){B[D]=B[D].split("$,$");var F={};for(var A=0;A<B[D].length;A++){var C=B[D][A].substr(0,B[D][A].indexOf("="));var G=B[D][A].substr(B[D][A].indexOf("=")+1,B[D][A].length);F[C]=G}if(E=="filter"){F=maxConfig.res.loadFilterItem(F)}F=maxConfig.res.postProccessItem(E,F);if(F.title){B[D]=F}else{B.splice(D,1);D--}}B.$sort("title");return B};maxConfig.res.loadFilterItem=function(D){var C={namespace:"",validate:'/m2filter[@version="1.0"]',items:"//package",attributes:{title:"@title",version:"@version",author:"@author",description:"@description",support_url:"@support_url"}};var A=maxXmlListParser.parseFile(maxConfig.res.filterPath+D.path,C);if(A==null){D.parseError=true;return D}else{if(A.length<1){D.parseError=true;return D}else{for(var B in A[0]){D[B]=A[0][B]}}}return D};maxConfig.res.postProccessItem=function(A,B){B.enabled=B.enabled=="1"?true:false;if(B.support_url){B.supportURL=B.support_url.$sanitizeURL();delete B.support_url}if(B.description){B.description=B.description.$sanitizeHTML()}switch(A){case"skin":B.preview=B.preview.$sanitizeURL();break;case"plugin":if(B.can_auto){B.canAutoStart=B.can_auto=="1"?true:false;delete B.can_auto}if(B.auto_start){B.autoStart=B.auto_start=="1"?true:false;delete B.auto_start}if(B.config){B.config=B.config=="1"?true:false}break;case"filter":break}return B};